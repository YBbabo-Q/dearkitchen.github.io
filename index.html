<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>亲爱的御膳房 - 情侣专属点菜平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义主题 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B',
                        secondary: '#A77DC2',
                        accent: '#FFD166',
                        neutral: '#F8F9FA',
                        dark: '#343A40'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .gradient-bg {
                background: linear-gradient(135deg, #FF6B8B 0%, #A77DC2 100%);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
            }
            .btn-bounce {
                transition: transform 0.2s ease;
            }
            .btn-bounce:active {
                transform: scale(0.95);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark">
    <!-- 顶部导航栏 -->
    <header class="gradient-bg text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-cutlery text-2xl"></i>
                <h1 class="text-2xl font-bold">亲爱的御膳房</h1>
            </div>
            
            <div class="flex items-center space-x-6">
                <button id="roleToggle" class="flex items-center space-x-1 bg-white/20 px-3 py-1.5 rounded-full text-sm backdrop-blur-sm hover:bg-white/30 transition-all">
                    <i class="fa fa-user"></i>
                    <span>切换角色</span>
                </button>
                
                <div class="relative" id="cartIconContainer">
                    <button id="cartToggle" class="relative p-2 rounded-full bg-white/20 hover:bg-white/30 transition-all">
                        <i class="fa fa-shopping-cart text-xl"></i>
                        <span id="cartCount" class="absolute -top-1 -right-1 bg-accent text-dark text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- 角色提示 -->
        <div id="roleIndicator" class="mb-6 p-3 bg-primary/10 border-l-4 border-primary rounded-r-md">
            <p class="text-primary font-medium"><i class="fa fa-info-circle mr-2"></i>当前角色: <span id="currentRole">点菜者</span> - 浏览菜单并选择喜欢的菜品</p>
        </div>
        
        <!-- 上传菜品区域 (默认隐藏，仅管理员可见) -->
        <div id="uploadSection" class="mb-10 hidden">
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-upload text-primary mr-2"></i>添加新菜品
                </h2>
                
                <form id="dishForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="dishName" class="block text-sm font-medium text-gray-700 mb-1">菜品名称</label>
                            <input type="text" id="dishName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="例如：草莓蛋糕" required="">
                        </div>
                        
                        <div>
                            <label for="dishCategory" class="block text-sm font-medium text-gray-700 mb-1">菜品类别</label>
                            <select id="dishCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="主食">主食</option>
                                <option value="小菜">小菜</option>
                                <option value="甜点">甜点</option>
                                <option value="饮料">饮料</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="dishDescription" class="block text-sm font-medium text-gray-700 mb-1">菜品描述</label>
                        <textarea id="dishDescription" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="简单描述一下这道菜吧..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">菜品图片</label>
                        <div class="flex items-center space-x-4">
                            <div id="imagePreviewContainer" class="w-32 h-32 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300">
                                <img id="imagePreview" src="" alt="菜品预览图" class="w-full h-full object-cover hidden">
                                <i class="fa fa-picture-o text-gray-400 text-3xl" id="previewPlaceholder"></i>
                            </div>
                            
                            <div>
                                <label for="dishImage" class="bg-primary text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-primary/90 transition-all btn-bounce inline-flex items-center">
                                    <i class="fa fa-image mr-2"></i>选择图片
                                </label>
                                <input type="file" id="dishImage" accept="image/*" class="hidden" onchange="previewImage(event)">
                                <p class="text-xs text-gray-500 mt-1">支持JPG、PNG格式</p>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="bg-primary text-white px-6 py-2.5 rounded-lg hover:bg-primary/90 transition-all btn-bounce inline-flex items-center">
                        <i class="fa fa-plus-circle mr-2"></i>添加到菜单
                    </button>
                </form>
            </div>
        </div>
        
        <!-- 菜单筛选和搜索 -->
        <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <h2 class="text-2xl font-bold">今日菜单</h2>
            
            <div class="w-full md:w-auto flex flex-col sm:flex-row gap-3">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="搜索菜品..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all w-full sm:w-64">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                
                <select id="categoryFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    <option value="all">所有类别</option>
                    <option value="主食">主食</option>
                    <option value="小菜">小菜</option>
                    <option value="甜点">甜点</option>
                    <option value="饮料">饮料</option>
                    <option value="其他">其他</option>
                </select>
            </div>
        </div>
        
        <!-- 菜品列表 -->
        <div id="dishGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12">
            <!-- 菜品卡片将通过JavaScript动态生成 -->
        </div>
        
        <!-- 空菜单提示 -->
        <div id="emptyMenu" class="hidden text-center py-16">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4">
                <i class="fa fa-utensils text-gray-400 text-2xl"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-500 mb-2">菜单还是空的呢</h3>
            <p class="text-gray-400 mb-4">切换到管理角色添加一些美味的菜品吧</p>
            <button id="goToUploadBtn" class="bg-primary text-white px-5 py-2 rounded-lg hover:bg-primary/90 transition-all btn-bounce">
                去添加菜品
            </button>
        </div>
    </main>
    
    <!-- 购物车侧边栏 -->
    <div id="cartSidebar" class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50">
        <div class="h-full flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center">
                    <i class="fa fa-shopping-cart text-primary mr-2"></i>我的选择
                </h3>
                <button id="closeCart" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div id="cartItems" class="flex-1 overflow-y-auto p-4 space-y-3">
                <!-- 购物车项目将通过JavaScript动态生成 -->
                <div id="emptyCartMessage" class="h-full flex flex-col items-center justify-center text-gray-400 py-10">
                    <i class="fa fa-shopping-basket text-4xl mb-3"></i>
                    <p>购物车还是空的</p>
                    <p class="text-sm">快去添加喜欢的菜品吧</p>
                </div>
            </div>
            
            <div class="p-4 border-t">
                <div class="flex justify-between items-center mb-4">
                    <span class="font-medium">总计</span>
                    <span id="cartTotal" class="font-bold text-lg">0 样菜品</span>
                </div>
                
                <button id="confirmOrder" class="w-full bg-gradient-to-r from-primary to-secondary text-white py-3 rounded-lg hover:opacity-90 transition-all btn-bounce flex items-center justify-center">
                    <i class="fa fa-heart mr-2"></i>确认选择
                </button>
            </div>
        </div>
    </div>
    
    <!-- 遮罩层 -->
    <div id="overlay" class="fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300 z-40"></div>
    
    <!-- 成功提示弹窗 -->
    <div id="successModal" class="fixed inset-0 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 transform scale-95 transition-transform duration-300">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-check text-2xl text-green-500"></i>
                </div>
                <h3 class="text-xl font-bold mb-2" id="modalTitle">操作成功</h3>
                <p class="text-gray-600 mb-6" id="modalMessage">您的操作已成功完成</p>
                <button id="closeModal" class="bg-primary text-white px-6 py-2.5 rounded-lg hover:bg-primary/90 transition-all btn-bounce">
                    确定
                </button>
            </div>
        </div>
    </div>
    
    <footer class="bg-dark text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p>爱点餐 © 2023 - 为情侣打造的专属点菜平台</p>
            <p class="text-sm text-gray-400 mt-1">用美食连接彼此的心意</p>
        </div>
    </footer>

    <script>
        // 全局数据
        let dishes = [];
        let cart = [];
        let isManager = false;
        
        // DOM元素
        const dishGrid = document.getElementById('dishGrid');
        const emptyMenu = document.getElementById('emptyMenu');
        const cartCount = document.getElementById('cartCount');
        const cartItems = document.getElementById('cartItems');
        const emptyCartMessage = document.getElementById('emptyCartMessage');
        const cartTotal = document.getElementById('cartTotal');
        const cartSidebar = document.getElementById('cartSidebar');
        const overlay = document.getElementById('overlay');
        const roleToggle = document.getElementById('roleToggle');
        const currentRole = document.getElementById('currentRole');
        const uploadSection = document.getElementById('uploadSection');
        const dishForm = document.getElementById('dishForm');
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const goToUploadBtn = document.getElementById('goToUploadBtn');
        const successModal = document.getElementById('successModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const closeModal = document.getElementById('closeModal');
        const confirmOrder = document.getElementById('confirmOrder');
        
        // 初始化
        function init() {
            // 从本地存储加载数据
            loadFromLocalStorage();
            
            // 渲染菜品
            renderDishes();
            
            // 渲染购物车
            renderCart();
            
            // 事件监听
            setupEventListeners();
        }
        
        // 从本地存储加载数据
        function loadFromLocalStorage() {
            const savedDishes = localStorage.getItem('coupleDiningDishes');
            const savedCart = localStorage.getItem('coupleDiningCart');
            
            if (savedDishes) {
                dishes = JSON.parse(savedDishes);
            }
            
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
        }
        
        // 保存数据到本地存储
        function saveToLocalStorage() {
            localStorage.setItem('coupleDiningDishes', JSON.stringify(dishes));
            localStorage.setItem('coupleDiningCart', JSON.stringify(cart));
        }
        
        // 设置事件监听
        function setupEventListeners() {
            // 角色切换
            roleToggle.addEventListener('click', toggleRole);
            
            // 表单提交
            dishForm.addEventListener('submit', handleDishSubmit);
            
            // 购物车开关
            document.getElementById('cartToggle').addEventListener('click', openCart);
            document.getElementById('closeCart').addEventListener('click', closeCart);
            overlay.addEventListener('click', closeCart);
            
            // 搜索和筛选
            searchInput.addEventListener('input', renderDishes);
            categoryFilter.addEventListener('change', renderDishes);
            
            // 去上传按钮
            goToUploadBtn.addEventListener('click', () => {
                if (!isManager) {
                    toggleRole();
                }
                document.getElementById('uploadSection').scrollIntoView({ behavior: 'smooth' });
            });
            
            // 关闭弹窗
            closeModal.addEventListener('click', closeSuccessModal);
            
            // 确认订单
            confirmOrder.addEventListener('click', handleConfirmOrder);
        }
        
        // 切换角色
        function toggleRole() {
            isManager = !isManager;
            currentRole.textContent = isManager ? '管理员' : '点菜者';
            uploadSection.classList.toggle('hidden', !isManager);
            
            // 重新渲染菜品，因为管理员可以删除菜品
            renderDishes();
        }
        
        // 处理菜品表单提交
        function handleDishSubmit(e) {
            e.preventDefault();
            
            const nameInput = document.getElementById('dishName');
            const categoryInput = document.getElementById('dishCategory');
            const descriptionInput = document.getElementById('dishDescription');
            const imageInput = document.getElementById('dishImage');
            
            // 验证
            if (!nameInput.value.trim()) {
                showSuccessModal('输入错误', '请填写菜品名称', false);
                return;
            }
            
            if (!imageInput.files || imageInput.files.length === 0) {
                showSuccessModal('输入错误', '请选择菜品图片', false);
                return;
            }
            
            // 创建新菜品
            const newDish = {
                id: Date.now().toString(),
                name: nameInput.value.trim(),
                category: categoryInput.value,
                description: descriptionInput.value.trim(),
                image: document.getElementById('imagePreview').src
            };
            
            // 添加到数组
            dishes.unshift(newDish);
            
            // 保存并重新渲染
            saveToLocalStorage();
            renderDishes();
            
            // 重置表单
            dishForm.reset();
            document.getElementById('imagePreview').src = '';
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('previewPlaceholder').classList.remove('hidden');
            
            // 显示成功消息
            showSuccessModal('添加成功', `已将${newDish.name}添加到菜单`);
        }
        
        // 预览图片
        function previewImage(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('imagePreview');
                const placeholder = document.getElementById('previewPlaceholder');
                
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                placeholder.classList.add('hidden');
            }
            reader.readAsDataURL(file);
        }
        
        // 渲染菜品列表
        function renderDishes() {
            // 清空现有内容
            dishGrid.innerHTML = '';
            
            // 检查是否为空
            if (dishes.length === 0) {
                dishGrid.classList.add('hidden');
                emptyMenu.classList.remove('hidden');
                return;
            }
            
            // 显示菜品网格，隐藏空提示
            dishGrid.classList.remove('hidden');
            emptyMenu.classList.add('hidden');
            
            // 获取搜索和筛选条件
            const searchTerm = searchInput.value.toLowerCase().trim();
            const category = categoryFilter.value;
            
            // 筛选菜品
            const filteredDishes = dishes.filter(dish => {
                const matchesSearch = dish.name.toLowerCase().includes(searchTerm) || 
                                     dish.description.toLowerCase().includes(searchTerm);
                const matchesCategory = category === 'all' || dish.category === category;
                return matchesSearch && matchesCategory;
            });
            
            // 渲染筛选后的菜品
            filteredDishes.forEach(dish => {
                const dishCard = createDishCard(dish);
                dishGrid.appendChild(dishCard);
            });
        }
        
        // 创建菜品卡片
        function createDishCard(dish) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-md overflow-hidden card-hover';
            
            // 检查是否在购物车中
            const inCart = cart.some(item => item.id === dish.id);
            
            card.innerHTML = `
                <div class="relative h-48 overflow-hidden">
                    <img src="${dish.image}" alt="${dish.name}" class="w-full h-full object-cover">
                    ${isManager ? `
                        <button class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full opacity-70 hover:opacity-100 transition-opacity delete-dish" data-id="${dish.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    ` : ''}
                    <div class="absolute top-2 left-2 bg-white/80 backdrop-blur-sm text-dark text-xs font-medium px-2 py-1 rounded-full">
                        ${dish.category}
                    </div>
                </div>
                <div class="p-4">
                    <h3 class="font-bold text-lg mb-1">${dish.name}</h3>
                    ${dish.description ? `<p class="text-gray-600 text-sm mb-3">${dish.description}</p>` : ''}
                    <button class="add-to-cart w-full bg-primary/10 text-primary py-2 rounded-lg hover:bg-primary hover:text-white transition-all btn-bounce ${inCart ? 'bg-green-100 text-green-600 hover:bg-green-600 hover:text-white' : ''}" data-id="${dish.id}">
                        <i class="fa ${inCart ? 'fa-check' : 'fa-plus'} mr-1"></i>
                        ${inCart ? '已选择' : '加入选择'}
                    </button>
                </div>
            `;
            
            // 添加到购物车事件
            if (!isManager) {
                card.querySelector('.add-to-cart').addEventListener('click', () => {
                    toggleCartItem(dish.id);
                });
            } else {
                // 删除菜品事件
                card.querySelector('.delete-dish').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteDish(dish.id);
                });
            }
            
            return card;
        }
        
        // 切换购物车项目
        function toggleCartItem(dishId) {
            const dish = dishes.find(d => d.id === dishId);
            if (!dish) return;
            
            const index = cart.findIndex(item => item.id === dishId);
            
            if (index === -1) {
                // 添加到购物车
                cart.push({...dish, quantity: 1});
                showSuccessModal('已添加', `${dish.name} 已加入选择`);
            } else {
                // 从购物车移除
                cart.splice(index, 1);
            }
            
            // 保存并更新UI
            saveToLocalStorage();
            renderCart();
            renderDishes(); // 更新"已选择"状态
        }
        
        // 删除菜品
        function deleteDish(dishId) {
            // 同时从购物车中移除
            cart = cart.filter(item => item.id !== dishId);
            
            // 从菜单中移除
            dishes = dishes.filter(dish => dish.id !== dishId);
            
            // 保存并更新UI
            saveToLocalStorage();
            renderDishes();
            renderCart();
            
            showSuccessModal('已删除', '菜品已从菜单中移除');
        }
        
        // 渲染购物车
        function renderCart() {
            // 更新购物车计数
            cartCount.textContent = cart.length;
            cartTotal.textContent = `${cart.length} 样菜品`;
            
            // 清空现有内容
            cartItems.innerHTML = '';
            
            // 检查购物车是否为空
            if (cart.length === 0) {
                cartItems.appendChild(emptyCartMessage);
                return;
            }
            
            // 添加购物车项目
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'flex items-center p-3 bg-gray-50 rounded-lg';
                
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md mr-3">
                    <div class="flex-1">
                        <h4 class="font-medium">${item.name}</h4>
                        <p class="text-sm text-gray-500">${item.category}</p>
                    </div>
                    <button class="remove-from-cart text-red-500 hover:text-red-700 p-2" data-id="${item.id}">
                        <i class="fa fa-times"></i>
                    </button>
                `;
                
                // 移除购物车项目事件
                cartItem.querySelector('.remove-from-cart').addEventListener('click', () => {
                    toggleCartItem(item.id);
                });
                
                cartItems.appendChild(cartItem);
            });
        }
        
        // 打开购物车
        function openCart() {
            cartSidebar.classList.remove('translate-x-full');
            overlay.classList.remove('opacity-0', 'pointer-events-none');
            document.body.style.overflow = 'hidden';
        }
        
        // 关闭购物车
        function closeCart() {
            cartSidebar.classList.add('translate-x-full');
            overlay.classList.add('opacity-0', 'pointer-events-none');
            document.body.style.overflow = '';
        }
        
        // 显示成功提示弹窗
        function showSuccessModal(title, message, isSuccess = true) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            
            // 更改图标颜色
            const icon = successModal.querySelector('i');
            if (isSuccess) {
                icon.className = 'fa fa-check text-2xl text-green-500';
                icon.parentElement.className = 'w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4';
            } else {
                icon.className = 'fa fa-exclamation text-2xl text-red-500';
                icon.parentElement.className = 'w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4';
            }
            
            // 显示弹窗
            successModal.classList.remove('opacity-0', 'pointer-events-none');
            successModal.querySelector('div').classList.remove('scale-95');
            successModal.querySelector('div').classList.add('scale-100');
            document.body.style.overflow = 'hidden';
        }
        
        // 关闭成功提示弹窗
        function closeSuccessModal() {
            successModal.classList.add('opacity-0', 'pointer-events-none');
            successModal.querySelector('div').classList.remove('scale-100');
            successModal.querySelector('div').classList.add('scale-95');
            document.body.style.overflow = '';
        }
        
        // 处理确认订单
        function handleConfirmOrder() {
            if (cart.length === 0) {
                showSuccessModal('选择为空', '请先添加菜品到选择中', false);
                return;
            }
            
            // 显示确认消息
            showSuccessModal('选择完成', '已成功提交您的选择，等待对方确认吧！');
            
            // 关闭购物车
            closeCart();
        }
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>


</body></html>